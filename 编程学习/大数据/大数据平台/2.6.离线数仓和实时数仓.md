## 离线数仓

离线数据仓库主要基于Hive等技术来构建T+1的离线数据

通过定时任务每天拉取增量数据导入到Hive表中

创建各个业务相关的主题维度数据，对外提供T+1的数据查询接口

### 离线数仓架构

数据源通过离线的方式导入到离线数仓中

数据分层架构：ODS、DWD、DM

下游应用根据业务需求选择直接读取 DM

## 实时数仓

实时数仓基于数据采集工具，将原始数据写入到Kafka等数据通道

数据最终写入到类似于HBase这样支持快速读写的存储系统

对外提供分钟级别、甚至秒级别的查询方案

### 实时数仓架构

业务实时性要求的不断提高，实时处理从次要部分变成了主要部分

Lambda 架构：在离线大数据架构基础上加了一个加速层，使用流处理技术完成实时性较高的指标计算

Kappa 架构：以实时事件处理为核心，统一数据处理

#### Lambda 架构

![image-20240716110809635](D:\user\person\notes\编程学习\大数据\大数据平台\assets\image-20240716110809635.png)

批处理层(Batch Layer)：存储管理主数据集（不可变的数据集）和预先批处理计算好的视图

速度处理层(Speed Layer)：实时处理新来的数据，降低批处理层的处理延时

响应查询的服务层(Serving Layer)：返回预先计算的数据视图和速度层处理构建好数据视图的合并结果来响应查询

##### Lambda架构不足

同样的需求需要开发两套一样的代码

同样的逻辑计算两次，整体资源占用会增多

#### Kappa 架构

Kappa 架构：以实时事件处理为核心，统一数据处理

![image-20240716111250225](D:\user\person\notes\编程学习\大数据\大数据平台\assets\image-20240716111250225.png)

与 Lambda 架构不同的是，Kappa 架构去掉了批处理层这一体系结构

统一了数据的处理方式，不再维护离线和实时两套代码逻辑

##### Kappa架构不足

需求修改或历史数据重新处理都通过上游重放完成

重新处理历史的吞吐能力会低于批处理

并不适用于批处理和流处理代码逻辑不一致的场景



#### Lambda VS Kappa

| 对比项         | Lambda架构                                           | Kappa架构                                                |
| -------------- | ---------------------------------------------------- | -------------------------------------------------------- |
| 实时性         | 实时                                                 | 实时                                                     |
| 计算资源       | 批和流同时运行，资源开销大                           | 只有流处理，仅针对新需求开发阶段运行两个作业，资源开销小 |
| 重新计算时吞吐 | 批式全量处理，吞吐较高                               | 流式全量处理，吞吐较批处理低                             |
| 开发、测试     | 每个需求都需要两套不同代码，开发、测试、上线难度较大 | 只需实现一套代码，开发、测试、上线难度相对较小           |
| 运维成本       | 维护两套系统（引擎），运维成本大                     | 只需维护一套系统（引擎），运维成本小                     |

### 大公司的实时数仓建设

阿里菜鸟实时数仓

![image-20240716112037066](D:\user\person\notes\编程学习\大数据\大数据平台\assets\image-20240716112037066.png)

美团实时数仓

![image-20240716112221054](D:\user\person\notes\编程学习\大数据\大数据平台\assets\image-20240716112221054.png)

### 实时数仓建设

整体架构设计通过分层设计为OLAP查询分担压力

复杂的计算统一在实时计算层做，避免给OLAP查询带来过大的压力

汇总计算通过OLAP数据查询引擎进行



整个架构中实时计算一般是Spark+Flink配合

消息队列Kafka一家独大，配合HBase、ES、Mysql进行数据落盘

OLAP领域Presto、Druid、Clickhouse、Greenplum等等层出不穷

## 离线数仓 VS 实时数仓

| 数仓类型 | 准确性   | 实时性         | 稳定性                   |
| -------- | -------- | -------------- | ------------------------ |
| 离线数仓 | 准确度高 | 时延一般在一天 | 稳定性好，方便重算       |
| 实时数仓 | 准确度低 | 分钟级延迟     | 稳定性差，需考虑数据回溯 |

## 参考文档

[数据库 - 什么是OLAP？主流八大开源OLAP技术架构对比 - 个人文章 - SegmentFault 思否](https://segmentfault.com/a/1190000040428093)