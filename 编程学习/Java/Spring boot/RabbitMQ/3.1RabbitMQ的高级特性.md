消息如何保障100%的投递成功？

方案一：详见1.1章节

方案二：消息的延迟投递，做二次确认，回调检查（高并发场景）





幂等性概念详解

幂等性是什么？

对一个事情执行多次操作，最终造成的结果相同



数据库中如何实现幂等？

我们可以借鉴数据库的乐观锁机制，比如我们执行一条更新库存的SQL语句

UPDATE T_REPS SET COUNT =COUNT -1 , VERSION =VERSION + 1 WHERE VERSION =1











在海量订单产生的业务高峰期，如何避免消息的重复性消费问题？



业界主流的幂等性操作：

- 唯一ID+指纹码 机制，利用数据库主键去重

  SELECT COUNT(1) FROM T_ORDER WHERE ID = 唯一ID + 指纹码

  需要考虑的问题：高并发下有数据库写入的性能瓶颈。

  解决方案：跟进ID进行分库分表进行算法路由

- 利用Redis的原子性去实现

  使用Redis进行幂等，需要考虑的问题

  第一：我们是否要进行数据落库，如果落库的话，关键解决的问题是数据库和缓存如何做到原子性？

  第二：如果不进行落库，那么都存储到缓存中，如何设置定时同步的策略？











