# 个性化用户认证流程

## 自定义登录页面
1. 新建resources/resources/SignIn.html
2. 在SecurityConfig类中，配置SignIn.html为登录页面并为其授权
3. 在SecurityConfig类中，配置登录表单提交url
4. 关闭跨站请求伪造
```java
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.formLogin()
                .loginPage("/SignIn.html")
                .loginProcessingUrl("/authentication/form")
                .and()
                .authorizeRequests()
                .antMatchers("/SignIn.html").permitAll()
                .anyRequest()
                .authenticated()
                .and()
                .csrf().disable();
    }
```



## 自定义登录成功处理
1. 新建BlogAuthenticationSuccessHandler类，实现AuthenticationSuccessHandler接口
2. 使用@Component("blogAuthenticationSuccessHandler")注解装饰BlogAuthenticationSuccessHandler类
3. 重写onAuthenticationSuccess()方法并编写登录成功后处理逻辑
```java
 @Override
    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response,
                                        Authentication authentication) throws IOException, ServletException {
        logger.info("登录成功");
        response.setContentType("application/json;charset=utf-8");
        response.getWriter().write(objectMapper.writeValueAsString(authentication));
    }
```
4. 在SecurityConfig中，配置自定义登录成功处理器
```java
  @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.formLogin()
                .loginPage("/authentication/request")
                .loginProcessingUrl("/authentication/form")
                .successHandler(blogAuthenticationSuccessHandler)
    }
```


Authentication信息解析
authenticated：是否经过认证
authority：角色
credentials：密码
remoteAddress：请求端地址
sessionId：
principal：UserDetails中的信息

## 自定义登录失败处理
1. 新建BlogAuthenticationFailureHandler类，实现AuthenticationFailureHandler接口。
2. 使用@Component("blogAuthenticationFailureHandler")注解装饰BlogAuthenticationFailureHandler类。
3. 重写onAuthenticationFailure()方法并编写登录失败处理逻辑。
```java
    @Override
    public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response,
                                        AuthenticationException exception) throws IOException, ServletException {
        logger.info("登录失败");
        response.setContentType("application/json;charset=utf-8");
        response.setStatus(HttpStatus.INTERNAL_SERVER_ERROR.value());
        response.getWriter().write(objectMapper.writeValueAsString(exception));
    }
```
4. 在SecurityConfig中，配置自定义登录失败处理器
```java
  @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.formLogin()
                .loginPage("/authentication/request")
                .loginProcessingUrl("/authentication/form")
                .successHandler(blogAuthenticationSuccessHandler)
                .failureHandler(blogAuthenticationFailureHandler)
    }
```


